<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OK PLAYLISTS - DEBUG</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background: #000; 
            color: #fff; 
            padding: 20px; 
        }
        .debug-panel {
            background: #111;
            border: 1px solid #333;
            padding: 20px;
            margin: 20px 0;
        }
        .test-btn {
            background: #666;
            color: #fff;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 10px;
            cursor: pointer;
        }
        .test-btn:hover { background: #888; }
        .result { 
            background: #222; 
            padding: 10px; 
            margin: 10px 0; 
            border-left: 3px solid #666; 
        }
        .success { border-left-color: #0f0; }
        .error { border-left-color: #f00; }
    </style>
</head>
<body>
    <h1>üîß OK PLAYLISTS DEBUG PANEL</h1>
    
    <div class="debug-panel">
        <h3>üìã Environment Check</h3>
        <div id="envCheck">Checking...</div>
    </div>

    <div class="debug-panel">
        <h3>üîó API Endpoint Tests</h3>
        <button class="test-btn" onclick="testSpotifyAuth()">Test Spotify Auth Endpoint</button>
        <button class="test-btn" onclick="testPlaylistsEndpoint()">Test Playlists Endpoint</button>
        <div id="apiResults"></div>
    </div>

    <div class="debug-panel">
        <h3>üéµ Spotify Configuration</h3>
        <div id="spotifyConfig">
            <p><strong>Expected Redirect URI:</strong> https://okplaylists.vercel.app/api/auth/callback</p>
            <p><strong>Current URL:</strong> <span id="currentUrl"></span></p>
        </div>
    </div>

    <div class="debug-panel">
        <h3>üöÄ Quick Actions</h3>
        <button class="test-btn" onclick="window.location.href='/api/auth/spotify'">Start Spotify Auth</button>
        <button class="test-btn" onclick="window.location.href='/'">Go to Main App</button>
    </div>

    <script>
        document.getElementById('currentUrl').textContent = window.location.origin;

        async function testSpotifyAuth() {
            const resultsDiv = document.getElementById('apiResults');
            
            try {
                const response = await fetch('/api/auth/spotify', { 
                    method: 'GET',
                    redirect: 'manual' // Don't follow redirects
                });
                
                if (response.type === 'opaqueredirect' || response.status === 0) {
                    resultsDiv.innerHTML += '<div class="result success">‚úÖ Spotify Auth Endpoint: Working (redirects to Spotify)</div>';
                } else if (response.status === 302 || response.status === 307) {
                    resultsDiv.innerHTML += '<div class="result success">‚úÖ Spotify Auth Endpoint: Working (redirect response)</div>';
                } else {
                    resultsDiv.innerHTML += `<div class="result error">‚ùå Spotify Auth Endpoint: Unexpected status ${response.status}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">‚ùå Spotify Auth Endpoint: ${error.message}</div>`;
            }
        }

        async function testPlaylistsEndpoint() {
            const resultsDiv = document.getElementById('apiResults');
            
            try {
                const response = await fetch('/api/spotify/playlists');
                
                if (response.status === 401) {
                    resultsDiv.innerHTML += '<div class="result success">‚úÖ Playlists Endpoint: Working (returns 401 - not authenticated, as expected)</div>';
                } else if (response.ok) {
                    resultsDiv.innerHTML += '<div class="result success">‚úÖ Playlists Endpoint: Working (authenticated)</div>';
                } else {
                    resultsDiv.innerHTML += `<div class="result error">‚ùå Playlists Endpoint: Status ${response.status}</div>`;
                }
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result error">‚ùå Playlists Endpoint: ${error.message}</div>`;
            }
        }

        // Check environment on load
        document.addEventListener('DOMContentLoaded', async function() {
            const envDiv = document.getElementById('envCheck');
            
            // Test if we can reach our API
            try {
                const response = await fetch('/api/auth/spotify', { 
                    method: 'GET',
                    redirect: 'manual'
                });
                envDiv.innerHTML = '‚úÖ API endpoints are accessible';
            } catch (error) {
                envDiv.innerHTML = `‚ùå API endpoints not accessible: ${error.message}`;
            }
        });
    </script>
</body>
</html>
